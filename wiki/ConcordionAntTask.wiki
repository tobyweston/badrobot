#summary Description of concordion-ant-task by bad.robot

= Generate a Concordion Overview Page =

The [http://code.google.com/p/badrobot/downloads/list concordion-ant-task-x.jar] contains a custom Ant task collect [http://www.concordion.org/ Concordion] test specs into a single overview page to be run with Concordion (using the {{{Run}}} command. See an example, [http://badrobot.googlecode.com/svn/trunk/bad.robot/concordion-ant-task/example/Overview.html here].

Use this as part of your build process to ensure *all* test htmls are run and summarised from a central starting point.

= Recommended Build Process =

Follow the recommended build process in your Ant script to leverage the awesome synergies of the power puff girls...

  # Clean everything
  # Compile everything
  # Collect Concordion tests into an overview page (see below)
  # Run unit (and other non-Concordion tests), exclude all Concordion tests (and the overview page)
  # Run just the generated Concordion overview page (and so all your Concordion tests)

Because the overview page is generated *every* time your run the build, the generated overview page will include all Concordion tests (selected by your user defined filter).

= Dependencies = 

Available to Ant, you must have

  # {{{concordion-ant-task-x.jar}}}
  # FreeMarker (lets say, version 2.3.16)


= Collecting Concordion Tests with Ant =

Setup your build file with the task.

{{{
<taskdef name="generate-test-overview" classname="bad.robot.concordion.ant.GenerateTestOverviewTask"/>
}}}

(having copied {{{concordion-ant-task-x.jar}}} into $ANT_HOME/lib or reference it in the {{{taskdef}}} above by some other [http://ant.apache.org/manual/Tasks/typedef.html Ant] mechanism).

then generate your overview page during your build

{{{
    <target name="generate-overview">
        <generate-test-overview template="Overview.ftl" output="Overview.html">
            <fileset dir="${basedir}" includes="**/specs/**/*.html"/>
        </generate-test-overview>
    </target>
}}}

all that's left is to run your newly generated Overview.html as a Concordion test. Ensure that you have a corresponding Java test ({{{@RunWith(ConcordionRunner.class)}}}) with the same name as your overview page (in our example, {{{Overview.jara}}}, then...

{{{
    <target name="run.acceptance.tests" depends="generate-overview">
        <junit printsummary="yes" haltonfailure="yes">
            <formatter type="plain"/>
            <test name="Overview"/>
        </junit>
    </target>
}}}

(Make sure you setup a filter that will only run the single {{{Overview}}} as a test, not all the Concordion tests).

= Test Meta-data =

You can give the test meta-data via the HTML, you can associate the following

  # group (for example, what iteration a test is associated with, or a functional area)
  # ignored (indicate whether Concordion should ignore this test)
  # title (the title of the test to display on the overview page)

You can see how to markup a test via the example (http://badrobot.googlecode.com/svn/trunk/bad.robot/concordion-ant-task/example/Overview.html). Click through to each test to see the markup.

= Debugging =

If things don't work, you can get a little more information out of the Ant task by using {{{-v}}} on the command like. For example,

{{{
ant -v -f build.xml generate-overview
}}}

It'll output where the fileset is looking for HTMLs. 

If you get something similar to the following

{{{
build.xml:666: java.io.IOException: org.xml.sax.SAXParseException: Premature end of file.
        at bad.robot.concordion.ant.XPather.<init>(XPather.java:26)
        at bad.robot.concordion.ant.TestHtmlUnmarshaller.unmarshall(TestHtmlUnmarshaller.java:9)
        at bad.robot.concordion.ant.TestHtmlUnmarshaller.unmarshall(TestHtmlUnmarshaller.java:6)
        at bad.robot.concordion.ant.TestHtmlCollectionBuilder.build(TestHtmlCollectionBuilder.java:29)
        at bad.robot.concordion.ant.GenerateTestOverviewTask.mergeTemplate(GenerateTestOverviewTask.java:50)
        at bad.robot.concordion.ant.GenerateTestOverviewTask.execute(GenerateTestOverviewTask.java:39)
        at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:291)
        <snip>
Caused by: org.xml.sax.SAXParseException: Premature end of file.
        at org.apache.xerces.parsers.DOMParser.parse(Unknown Source)
        at org.apache.xerces.jaxp.DocumentBuilderImpl.parse(Unknown Source)
        at javax.xml.parsers.DocumentBuilder.parse(DocumentBuilder.java:208)
        at bad.robot.concordion.ant.XPather.<init>(XPather.java:22)
        ... 22 more 
}}}

It _may_ be that the HTML isn't well formed. It might also be because rodents chewed the wrong cable. Your millage may vary.
 